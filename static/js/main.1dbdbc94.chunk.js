(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{102:function(e,t,a){e.exports={container:"FriendSlot_container__223BG",nameText:"FriendSlot_nameText__2Yyyb",image:"FriendSlot_image__1NcFs"}},139:function(e,t,a){e.exports={container:"ChatInput_container__32lBX",input:"ChatInput_input__Pam09"}},252:function(e,t,a){e.exports={scrollDiv:"FriendsList_scrollDiv__2Fw1_"}},253:function(e,t,a){e.exports={scrollDiv:"ChatWindow_scrollDiv__o2kPR"}},254:function(e,t,a){e.exports={text:"EmptyChat_text__1vCl4"}},255:function(e,t,a){e.exports={title:"NavBar_title__2Fh_s"}},259:function(e,t,a){e.exports=a(542)},264:function(e,t,a){},275:function(e,t){},277:function(e,t,a){var n={"./N3Lexer":105,"./N3Lexer.js":105,"./N3Parser":106,"./N3Parser.js":106,"./N3Store":152,"./N3Store.js":152,"./N3StreamParser":153,"./N3StreamParser.js":153,"./N3StreamWriter":160,"./N3StreamWriter.js":160,"./N3Util":107,"./N3Util.js":107,"./N3Writer":109,"./N3Writer.js":109};function s(e){var t=r(e);return a(t)}function r(e){if(!a.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}s.keys=function(){return Object.keys(n)},s.resolve=r,e.exports=s,s.id=277},280:function(e,t){},282:function(e,t){},298:function(e,t){},300:function(e,t){},348:function(e,t){},349:function(e,t){},351:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=351},396:function(e,t){},397:function(e,t){},461:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=461},488:function(e,t){function a(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=488},542:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(137),o=a.n(r),c=(a(264),a(64)),i=a.n(c),l=a(251),u=a(34),h=a(35),d=a(38),m=a(36),f=a(39),g=a(44),p=a.n(g),w=a(256),v=a(51),b=a(1),y=a.n(b),E=a(138),k=a.n(E),C=a(102),_=a.n(C),x=function(e){var t=e.friend;return s.a.createElement("div",{className:_.a.container,index:e.index,webid:t.webId},s.a.createElement("div",{className:_.a.image,style:{backgroundImage:"url(".concat(t.picture,")")}}),s.a.createElement("strong",{className:_.a.nameText,index:e.index,webid:t.webId},t.name))},N=a(252),O=a.n(N),I=function(e){return s.a.createElement(k.a,{variant:"flush",className:O.a.scrollDiv},e.friends.map(function(t,a){var n=t.webId.split(".")[0].replace("https://","");return s.a.createElement(k.a.Item,{action:!0,href:"#"+n,key:a,onClick:function(){return e.onClick(t.webId)}},s.a.createElement(x,{friend:t,index:a}))}))},M=a(52),j=a.n(M),F=a(18),S=a.n(F),D=a(37),T=a.n(D),L=a(16),P=a.n(L),U=a(82),A=a.n(U),W=function(e){return s.a.createElement("div",{className:A.a.container},s.a.createElement("div",{className:P()(A.a.message,"me"===e.from?A.a.me:A.a.friend)},e.message.content))},R=a(253),Y=a.n(R),B=a(254),G=a.n(B),H=function(e){var t="";return t=e.nomessages?"You have no chat history with this person...":"Select a friend to start chatting",s.a.createElement(T.a,{style:{height:"100%"}},s.a.createElement(S.a,{sm:!0,lg:!0}),s.a.createElement(S.a,{sm:"6",md:"6",lg:"6",style:{marginTop:"auto",marginBottom:"auto"}},s.a.createElement("h1",{className:G.a.text},t)),s.a.createElement(S.a,{sm:!0,lg:!0}))},K=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(m.a)(t).call(this,e))).state={webId:void 0,friends:a.props.friends,messages:a.props.messages},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"componentDidUpdate",value:function(){var e=document.getElementById("scrollDiv");e&&(console.log("scroll baby scroll"),e.scrollTop=e.scrollHeight)}},{key:"render",value:function(){if(console.log(this.props.messages),this.props.messages.length<=0)return s.a.createElement(j.a.Content,{style:{height:"84%",overflowY:"scroll"}},this.props.friends.map(function(e,t){var a=e.webId.split(".")[0].replace("https://","");return s.a.createElement(j.a.Pane,{eventKey:"#"+a,key:t,style:{height:"100%"}},s.a.createElement(H,{nomessages:!0}))}));var e=this.props.messages.map(function(e){return s.a.createElement(W,{message:e.message,from:e.from})});return s.a.createElement(j.a.Content,{className:Y.a.scrollDiv,id:"scrollDiv",style:{height:"calc(100% - 120px)",overflowY:"auto",boxShadow:"4px 2px 4px rgba(0, 0, 0, 0.5)"}},this.props.friends.map(function(t,a){var n=t.webId.split(".")[0].replace("https://","");return s.a.createElement(j.a.Pane,{eventKey:"#"+n,key:a},e)}))}}]),t}(s.a.Component),J=a(100),X=a.n(J),q=a(65),$=a.n(q),Q=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(m.a)(t).call(this,e))).state={newChat:"",canAddFriend:!1},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"changeChatToAdd",value:function(e){var t=this,a=new XMLHttpRequest,n=e.target.value;a.onreadystatechange=function(){a.readyState===XMLHttpRequest.DONE&&(200===a.status&&!1===t.state.canAddFriend?t.setState({newChat:n,canAddFriend:!0}):t.setState({canAddFriend:!1}))},new RegExp(/(\w+(:\/\/){1})(\w+\.)(\w+\.)(\w+\/)+/g).test(e.target.value)&&(a.open("GET",n),a.send());if(!1===/[ !@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(e.target.value)){var s="https://"+e.target.value+".solid.community/profile/card#me";a.open("GET",s),a.send()}}},{key:"render",value:function(){return s.a.createElement(T.a,{style:{margin:"5%"}},s.a.createElement(S.a,{lg:"8"},s.a.createElement(X.a,{placeholder:"Add a new chat:",onChange:this.changeChatToAdd.bind(this)})),s.a.createElement(S.a,{lg:"2"},this.state.canAddFriend?s.a.createElement($.a,{onClick:this.props.onClick,webId:this.state.newChat},"+"):s.a.createElement($.a,{disabled:!0},"+")),s.a.createElement(S.a,{lg:!0}))}}]),t}(s.a.Component),V=a(139),z=a.n(V),Z=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(m.a)(t).call(this,e))).state={message:""},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"changeMessage",value:function(e){this.setState({message:e.target.value}),console.log(this.state)}},{key:"sendMessage",value:function(){this.props.onClick(this.state.message),this.setState({message:""})}},{key:"render",value:function(){return s.a.createElement(T.a,{className:z.a.container},s.a.createElement(S.a,{lg:"9"},s.a.createElement(X.a,{className:z.a.input,placeholder:"Enter your message",rows:"2",as:"textarea",value:this.state.message,onChange:this.changeMessage.bind(this)})),s.a.createElement(S.a,{lg:"3"},""!==this.state.message?s.a.createElement($.a,{onClick:this.sendMessage.bind(this),message:this.state.message},"Send"):s.a.createElement($.a,{disabled:!0},"Send")))}}]),t}(s.a.Component),ee=a(83),te=a.n(ee),ae=new y.a.Namespace("http://www.w3.org/ns/ldp#"),ne=new y.a.Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),se=new y.a.Namespace("http://xmlns.com/foaf/0.1/"),re=new y.a.Namespace("http://www.w3.org/2006/vcard/ns#"),oe=new y.a.Namespace("http://www.w3.org/ns/auth/acl#"),ce=new y.a.Namespace("http://www.w3.org/ns/pim/meeting#"),ie=new y.a.Namespace("http://purl.org/dc/elements/1.1/"),le=new y.a.Namespace("http://www.w3.org/2005/01/wf/flow#"),ue=new y.a.Namespace("http://rdfs.org/sioc/ns#"),he=new y.a.Namespace("http://purl.org/dc/terms/"),de=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(m.a)(t).call(this,e))).state={webId:void 0,contacts:[],chats:[],ownMessages:void 0,friendMessages:void 0,messages:void 0,newContact:void 0,currentChat:window.location.href.split("#").length>1?"#"+window.location.href.split("#")[1]:void 0},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"fetchChats",value:function(){var e=this,t=y.a.graph(),a=new y.a.Fetcher(t),n=this.state.webId.replace("profile/card#me","inbox/");a.load(n).then(function(){var a=t.each(y.a.sym(n),ae("contains")),s=[],r=[];a.forEach(function(e){var t=y.a.graph(),a=new y.a.Fetcher(t);r.push(a.load(e.value).then(function(){if(t.any(null,ne("type"),ce("Chat"))){var a=e.value.split("/"),n="https://"+a[a.length-1]+".solid.community/profile/card#me";console.log(n),s.push(n)}}))}),Promise.all(r).then(function(t){e.setState({chats:s}),e.fetchContacts(),e.checkForMessages(s);var a=window.location.href.split("#")[1];if(a){var n="https://"+a+".solid.community/profile/card#me";s.includes(n)&&e.fetchMessages(n)}})})}},{key:"fetchContacts",value:function(){var e=this,t=y.a.graph(),a=new y.a.Fetcher(t),n=this.state.webId,s=y.a.graph(),r=new y.a.Fetcher(s),o=n.replace("card#me","card.acl#viewer");r.load(o);var c=this.state.chats.map(function(e){return a.load(e).then(function(){console.log("Fetched "+e+"'s Profile");var a=t.any(y.a.sym(e),se("name")),n=t.any(y.a.sym(e),re("hasPhoto"));n=n?n.value:"";var r=s.statementsMatching(o,oe("agent"),y.a.sym(e)).length>0;return{name:a.value,webId:e,access:r,picture:n}})});Promise.all(c).then(function(t){e.setState({contacts:t})})}},{key:"fetchMessages",value:function(e){var t=this,a=y.a.graph(),n=new y.a.Fetcher(a),s=this.state.webId.split(".")[0].replace("https://",""),r=this.state.webId.replace("profile/card#me","inbox/"),o=e.split(".")[0].replace("https://",""),c=e.replace("profile/card#me","inbox/"+s),i=[n.load(r+o).then(function(e){var t=y.a.sym(r+o),n=a.each(t,le("message")).map(function(e){e=y.a.sym(e);var t=a.any(e,ue("content")),n=a.any(e,ie("created")),s=n?"":a.any(e,he("created"));return{content:t.value,created:n?n.value:s.value}});return console.log(n),n}).catch(function(e){console.log("You haven't send any messages yet!")})];i.push(n.load(c).then(function(e){return a.each(y.a.sym(c),le("message")).map(function(e){e=y.a.sym(e.value);var t=a.any(e,ue("content")),n=a.any(e,ie("created")),s=n?"":a.any(e,he("created"));return{content:t.value,created:n?n.value:s.value}})}).catch(function(e){console.log("This friend has no chat with you yet.")})),console.log(i),Promise.all(i).then(function(e){console.log(e);var a=t.sortMessages(e[0],e[1]);t.setState({messages:a})}),console.log(this.state.messages)}},{key:"sendMessage",value:function(e){var t=this,a=new Date,n=y.a.graph(),s=new y.a.Fetcher(n),r=new y.a.UpdateManager(n),o=this.state.webId.replace("profile/card#me","inbox/"),c=window.location.href.split("#")[1];s.load(o+c).then(function(n){var s=y.a.sym(o+c),i=y.a.sym(t.state.webId),l=new y.a.sym(o+c+"#Msg"+Math.floor(1231231241*Math.random())),u=[y.a.st(s,le("message"),l,s.doc()),y.a.st(l,ie("created"),a,s.doc()),y.a.st(l,se("maker"),i,s.doc()),y.a.st(l,ue("content"),y.a.lit(e),s.doc())];r.update([],u,function(e,a,n){if(a){console.log("Message sent!");var s="https://"+c+".solid.community/profile/card#me";t.fetchMessages(s)}else alert(n)})}).catch(function(e){console.log("Could not find inbox... Maybe try to re-add this friend to your chat")})}},{key:"addChat",value:function(e){var t=this,a=y.a.graph(),n=new y.a.Fetcher(a),s=new y.a.UpdateManager(a),r=this.state.webId.split(".")[0].replace("https://",""),o=this.state.webId.replace("profile/card#me","inbox/"),c=e.target.getAttribute("webId").split(".")[0].replace("https://",""),i=this.state.webId.replace(r,c);n.load(o+c).catch(function(e){var a=y.a.sym(o+c),n=y.a.sym(t.state.webId),r=y.a.sym(i),l=y.a.sym(o+c+".acl").doc(),u=y.a.sym(o+c+".acl#viewer"),h=y.a.sym(o+c+".acl#owner"),d=[y.a.st(a,ne("type"),ce("Chat"),a.doc()),y.a.st(a,ie("title"),y.a.lit("Chat","en"),a.doc()),y.a.st(a,ie("created"),new Date,a.doc())];s.put(a,d,"text/turtle",function(e,t,a){t?console.log("Created new chatfile for chat data with "+c):alert(a)});var m=[y.a.st(h,oe("agent"),n,l),y.a.st(h,oe("accessTo"),a,l),y.a.st(h,oe("mode"),oe("Control"),l),y.a.st(h,oe("mode"),oe("Read"),l),y.a.st(h,oe("mode"),oe("Write"),l),y.a.st(u,oe("agent"),r,l),y.a.st(u,oe("accessTo"),a,l),y.a.st(u,oe("mode"),oe("Read"),l)];s.put(l,m,"text/turtle",function(e,t,a){t?console.log("New ACL File has been created"):console.log(a)}),t.fetchChats()})}},{key:"listenForMessage",value:function(e,t){var a=new WebSocket(e.replace("https","wss").replace("/inbox/"+t,""));a.onopen=function(){this.send("sub "+e),console.log("sub to chat-socket")},a.onmessage=function(t){if(console.log(t),t.data&&"pub"===t.data.slice(0,3)){var a=e.split(".")[0].replace("https://",""),n="https://"+a+".solid.community/profile/card#me";(window.location.href.split("#")?window.location.href.split("#")[1]:void 0)===a&&this.fetchMessages(n)}}.bind(this)}},{key:"checkForMessages",value:function(e){var t=this;console.log(e);var a=y.a.graph(),n=(new y.a.Fetcher(a),this.state.webId.split(".")[0].replace("https://","")),s=this.state.webId.replace("profile/card#me","inbox/");(e?e.map(function(e){var t=e.split(".")[0].replace("https://","");return s.replace(n,t)+n}):void 0).forEach(function(e){t.listenForMessage(e,n)})}},{key:"fetchUser",value:function(){var e=this;p.a.trackSession(function(t){t&&(console.log("You are logged in... Fetching your data now"),e.setState({webId:t.webId},function(){console.log("feeeeeeeeeeeeeeeeeeeeeeeeeeeeeetch"),e.fetchChats()}))})}},{key:"componentDidMount",value:function(){this.fetchUser()}},{key:"sortMessages",value:function(e,t){if(void 0!==e||void 0!==t){var a=[];for(var n in e)a.push({message:e[n],from:"me"});for(n in t)a.push({message:t[n],from:"friend"});return a.sort(function(e,t){return new Date(e.message.created)-new Date(t.message.created)}),a}}},{key:"render",value:function(){var e=this.state.messages;return console.log(this.state),s.a.createElement(T.a,{className:te.a.container},s.a.createElement(j.a.Container,{defaultActiveKey:this.state.currentChat},s.a.createElement(S.a,{lg:"4"},s.a.createElement(Q,{onClick:this.addChat.bind(this)}),s.a.createElement(I,{onClick:this.fetchMessages.bind(this),friends:this.state.contacts})),s.a.createElement(S.a,{lg:"8",className:P()(te.a.container,te.a.borderLeft)},this.state.messages?s.a.createElement("div",{className:te.a.container},s.a.createElement(K,{webId:this.state.webId,fetchMessage:this.fetchMessages.bind(this),friends:this.state.contacts,messages:e}),s.a.createElement(Z,{onClick:this.sendMessage.bind(this)})):s.a.createElement(H,null))))}}]),t}(s.a.Component),me=a(140),fe=a.n(me),ge=a(101),pe=a(255),we=a.n(pe),ve=function(e){return s.a.createElement("div",null,s.a.createElement(fe.a,{style:{height:"90px"},bg:"dark",variant:"dark",fixed:"top"},s.a.createElement(fe.a.Brand,{style:{marginLeft:"auto",marginRight:"auto"},className:we.a.title},"OWNCHAT",s.a.createElement("p",null,"by SOIL PROTOCOL")),s.a.createElement(ge.a,{onClick:e.onClick},e.webId?"Logout":"Login")))},be=function(e){return s.a.createElement(T.a,null,s.a.createElement(S.a,{lg:!0}),s.a.createElement(S.a,{lg:"6"},s.a.createElement("h1",{style:{margin:"10%"}},"You are not logged in! To take ownership of your messages and contacts, please register or login."),s.a.createElement(ge.a,{onClick:e.onClick,style:{margin:"10%"}},"Login")),s.a.createElement(S.a,{lg:!0}))},ye=function(e){function t(e){var a;return Object(u.a)(this,t),(a=Object(d.a)(this,Object(m.a)(t).call(this,e))).state={webId:void 0},a}return Object(f.a)(t,e),Object(h.a)(t,[{key:"login",value:function(){var e=Object(l.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.currentSession();case 2:if(t=e.sent){e.next=8;break}return e.next=6,p.a.login("https://solid.community");case 6:e.next=9;break;case 8:this.setState({webId:t.webID});case 9:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=this;p.a.logout().then(function(){e.setState({webId:void 0})})}},{key:"componentDidMount",value:function(){var e=this;p.a.trackSession(function(t){t?(console.log("You are logged in... Fetching your data now"),e.setState({webId:t.webId})):console.log("You are logged out...")})}},{key:"render",value:function(){var e=this;return console.log("Rerendered"),s.a.createElement("div",{style:{height:"100%"}},s.a.createElement(ve,{onClick:this.state.webId?this.logout.bind(this):this.login.bind(this),webId:this.state.webId}),s.a.createElement(w.a,null,s.a.createElement(v.c,null,s.a.createElement("div",{style:{height:"100%",marginTop:90}},s.a.createElement(v.a,{path:"/",render:function(){return e.state.webId?s.a.createElement(de,null):s.a.createElement(be,{onClick:e.login.bind(e)})}})))))}}]),t}(s.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(s.a.createElement(ye,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},82:function(e,t,a){e.exports={container:"Message_container__3Q20i",message:"Message_message__2O8iJ",me:"Message_me__2_Kpp",friend:"Message_friend__g5x95"}},83:function(e,t,a){e.exports={container:"ChatPage_container__3yPG0",borderLeft:"ChatPage_borderLeft__13V-C"}}},[[259,1,2]]]);
//# sourceMappingURL=main.1dbdbc94.chunk.js.map